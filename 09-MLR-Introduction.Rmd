
# The Multiple Linear Regression (MLR) Model {#mlr}

## Multiple Linear Regression

Simple linear regression (SLR) gave us a tool to model the relationship between a predictor ($x$) and an outcome ($Y$):

$$Y_i = \beta_0 + \beta_1x_{i1} + \epsilon_i$$
This has a clear drawback: **most real-world outcomes are impacted by more than one variable.** Multiple linear regression (MLR) extends SLR to include multiple predictors:

\begin{equation}
Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \dots + \beta_kx_{ik} +  \epsilon_i
(\#eq:mlr)
\end{equation}

As we will see, the mathematical details of SLR extend readily to having more than one predictor variable. However, the graphical representations are often more difficult to create.


The multiple linear regression model \@ref(eq:mlr) has analogous assumptions to simple linear regression:
* $E[\epsilon_i] = 0$
* $Var(\epsilon_i) = \sigma^2$
* $\epsilon_i$ are uncorrelated

In Chapter \@ref(sec:mlrmx), we will see an alternative form of the MLR model that uses matrix algebra to simplify computations.


<!-- ### MLR -- Outline of upcoming topics -->

<!-- We will cover MLR in the next several lectures: -->

<!-- * Interpretation of model parameters (this lecture) -->
<!-- * Estimation of parameters (Lecture 11) -->
<!-- * Inference using MLR (Lectures 12 \& 13) -->
<!-- * Categorical variables in MLR (Lecture 14) -->

<!-- We will then discuss how we can check model assumptions and modify our model to deal with violations of the assumptions. -->

<!-- *First, a caution: One topic not yet covered is assessing model adequacy and checking model assumptions (Chapter 4 in the textbook). These are very important, but will be easier to cover after discussing MLR.*  -->


## Example: Penguins

```{r g-penguin-flip-mass-3, echo=FALSE, fig.cap="Flipper length and body mass in the Palmer Penguin dataset."}
g_penguin_flip_mass <- penguins %>%
  rename(Sex=sex) %>%
  filter(!is.na(Sex)) %>%
  ggplot(aes(x=flipper_length_mm,
           y=body_mass_g)) +
  theme_bw() + 
  geom_point(aes(col=Sex)) +
    xlab("Flipper Length (mm)") +
    ylab("Body Mass (g)")
g_penguin_flip_mass
```

```{r eval=FALSE, eval=FALSE}

mel_lm1 <- lm(mort~latitude, data=melanoma)
ggplot(melanoma) + theme_bw() + 
   geom_point(aes(x=latitude, y=mort)) +
   xlab("State Latitude (degrees)") + ylab("Melanoma Mortality Rate (per 10 million)") +
   geom_abline(aes(slope=coef(mel_lm1)[2],
                   intercept=coef(mel_lm1)[1]))
```


Does the mortality rate differ between states that do and do not border the ocean?
```{r eval=FALSE, echo=TRUE, size="footnotesize"}
melanoma %>%
   group_by(Ocean=ocean) %>%
   summarize(`Mean Mortality`=round(mean(mort), digits=1))
```

```{r eval=FALSE, echo=FALSE, size="footnotesize"}
g_mel_dens <- ggplot(melanoma) +  theme_bw() + 
   geom_density(aes(x=mort, y=stat(count), fill=factor(ocean), group=factor(ocean)), alpha=0.3) +
   ylab("Density") + xlab("Melanoma Mortality Rate (per 10 million)") +
   scale_fill_discrete(name="Borders Ocean", breaks=0:1, labels=c("No", "Yes"))
```

```{r eval=FALSE, echo=F}
g_mel_dens 
```

```{r eval=FALSE, eval=FALSE}
mel_lm2 <- lm(mort~latitude + ocean, data=melanoma)
g_mel2 <- ggplot(melanoma) + theme_bw() +
   geom_point(aes(x=latitude, y=mort, col=as.factor(ocean))) +
   xlab("State Latitude (degrees)") + ylab("Melanoma Mortality Rate (per 10 million)") +
   scale_color_discrete(name="Borders Ocean", breaks=0:1, labels=c("No", "Yes")) +
      geom_abline(aes(slope=coef(mel_lm2)[2],
                   intercept=coef(mel_lm2)[1], col="0"))  +
      geom_abline(aes(slope=coef(mel_lm2)[2],
                   intercept=coef(mel_lm2)[1] + coef(mel_lm2)["ocean"],
                   col="1"))
g_mel2
```


### MLR Model for Melanoma Data

* $Y_i =$ Melanoma mortality rate in state $i$
* $x_{i1} =$ Latitude for state $i$
* $x_{i2} =$ Indicator for state $i$ bordering ocean (0=No, 1=Yes)

Instead of the SLR Model $Y_i = \beta_0 + \beta_1x_{i1} + \epsilon_i$

We can use the model

$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i$$

$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i$$

For states that DO NOT border the ocean ($x_{i2} = 0$):

\begin{align*}
E[Y_i] &= \beta_0 + \beta_1x_{i1} + \beta_2(0)\\
&= \beta_0 + \beta_1x_{i1}
\end{align*}


For states that DO border the ocean ($x_{i2} = 1$):

\begin{align*}
E[Y_i] &= \beta_0 + \beta_1x_{i1} + \beta_2(1) \\
&= (\beta_0 + \beta_2) + \beta_1x_{i1}
\end{align*}

## MLR Model for Melanoma Data

```{r eval=FALSE, eval=FALSE}
g_mel2
```



## Interpreting the MLR model

$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i$$


* $\beta_0 =$ Average value of $Y_i$ when $x_{i1}=0$ and $x_{i2}=0$
* $\beta_1 =$ Average difference in $Y_i$ for a 1-unit difference in $x_{i1}$ **among observations with the same value of $x_{i2}$**
* $\beta_2 =$ Average difference in $Y_i$ for a 1-unit difference in $x_{i2}$ **among observations with the same value of $x_{i1}$**


$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i$$

* $Y_i =$ Melanoma mortality rate in state $i$
* $x_{i1} =$ Latitude for state $i$
* $x_{i2} =$ Indicator for state $i$ bordering ocean (0=No, 1=Yes)


How do we interpret $\beta_1$ in this example?

\vspace{3in}


$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i$$

* $Y_i =$ Melanoma mortality rate in state $i$
* $x_{i1} =$ Latitude for state $i$
* $x_{i2} =$ Indicator for state $i$ bordering ocean (0=No, 1=Yes)

How do we interpret $\beta_0$ in this example?

\vspace{3in}

$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \epsilon_i$$

* $Y_i =$ Melanoma mortality rate in state $i$
* $x_{i1} =$ Latitude for state $i$
* $x_{i2} =$ Indicator for state $i$ bordering ocean (0=No, 1=Yes)

How do we interpret $\beta_2$ in this example?

\vspace{3in}


### Example: Denver Broncos

```{r eval=FALSE, include=FALSE}
nfl_den <- read_csv(paste0(data_dir, "nfl2018_denver_offense.csv"))
nfl_den <- nfl_den %>%
    filter(play_type %in% c("pass", "run")) %>%
    filter(!interception, !fumble_lost, !penalty)
mean(nfl_den$yards_gained)
```


In 2018, the Denver Broncos has 601 pass attempts and 383 rushing attempts that gained an average of 5.63 yards per play.\footnote{Sacks, scrambles, turnovers, and plays with accepted penalties are excluded.}

```{r eval=FALSE, out.width="75%"}
g_den1 <- ggplot(nfl_den) + theme_bw() + 
   geom_point(aes(x=yardline_100, y=yards_gained, col=play_type)) +
   scale_color_discrete(name="Play Type") + xlab("Yards to Endzone") + ylab("Yards Gained")
g_den1
```


```{r eval=FALSE, include=FALSE}
summary(lm(yards_gained ~ yardline_100 + play_type, data=nfl_den))
```



### Interpreting the MLR model

* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Play Type (0 = pass, 1 = run)

The MLR model fit to this data is:

$$\hat y_i = 3.83 + 0.042x_{i1} - 1.08x_{i2}$$


What does the number 3.83 represent?

\vspace{2in}



* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Play Type (0 = pass, 1 = run)

The MLR model fit to this data is:

$$\hat y_i = 3.83 + 0.042x_{i1} - 1.08x_{i2}$$


What does the number 0.042 represent?

\vspace{2in}


* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Play Type (0 = pass, 1 = run)

The MLR model fit to this data is:

$$\hat y_i = 3.83 + 0.042x_{i1} - 1.08x_{i2}$$


What does the number $-1.08$ represent?

\vspace{2in}

### Example: Denver Broncos (v2)

```{r eval=FALSE, eval=FALSE}
g_den2a <- ggplot(nfl_den) + theme_bw() + 
   geom_point(aes(x=yardline_100, y=yards_gained)) +
   scale_color_discrete(name="Play Type") + xlab("Yards to Endzone") + ylab("Yards Gained") 

g_den2b <- ggplot(nfl_den) + theme_bw() + 
   geom_point(aes(x=ydstogo, y=yards_gained)) +
   scale_color_discrete(name="Play Type") + xlab("Yards to Go") + ylab("Yards Gained") 
grid.arrange(g_den2a, g_den2b, ncol=2)
```



```{r eval=FALSE, include=FALSE}
summary(lm(yards_gained ~ yardline_100 + ydstogo, data=nfl_den))
```

* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go

The MLR model fit to this data is:

$$\hat y_i = 2.42 + 0.035x_{i1} + 0.158x_{i2}$$

```{r eval=FALSE, echo=F}
x <- y <- seq(-10, 10, length= 30)
f <- function(x,y){ x*2 + y -3}
z <- outer(x,y,f)
res <- persp(x, y, z, theta = 30, phi = 30, expand = 0.5, col = "lightblue", xlab="Yards to Endzone", ylab="Yards to Go", zlab="Yards Gained")
```


* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go

The MLR model fit to this data is:

$$\hat y_i = 2.42 + 0.035x_{i1} + 0.158x_{i2}$$



What does the number 2.42 represent?

\vspace{2in}


* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go

The MLR model fit to this data is:

$$\hat y_i = 2.42 + 0.035x_{i1} + 0.158x_{i2}$$



What does the number 0.035 represent?

\vspace{2in}


* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go

The MLR model fit to this data is:

$$\hat y_i = 2.42 + 0.035x_{i1} + 0.158x_{i2}$$



What does the number 0.158 represent?

\vspace{2in}






### Example: Denver Broncos (v3)

```{r eval=FALSE, eval=FALSE}
ggpairs(nfl_den, aes(colour = play_type, alpha = 0.4), columns = c("ydstogo", "yardline_100", "yards_gained"))
```



```{r eval=FALSE, include=FALSE}
summary(lm(yards_gained ~ yardline_100 + ydstogo + play_type, data=nfl_den))
```

* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go 
* $x_{i3} =$ Play Type (0=pass, 1= run)

The MLR model fit to this data is:

$$\hat y_i = 2.84 + 0.036x_{i1} + 0.14x_{i2} - 0.95x_{i3}$$

What is the meaning of the value 2.84?

\vspace{2in}


* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go 
* $x_{i3} =$ Play Type (0=pass, 1= run)

The MLR model fit to this data is:

$$\hat y_i = 2.84 + 0.036x_{i1} + 0.14x_{i2} - 0.95x_{i3}$$

What is the meaning of the value 0.036?

\vspace{2in}



* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go 
* $x_{i3} =$ Play Type (0=pass, 1= run)

The MLR model fit to this data is:

$$\hat y_i = 2.84 + 0.036x_{i1} + 0.14x_{i2} - 0.95x_{i3}$$

What is the meaning of the value 0.14?

\vspace{2in}


* $Y_i =$ Yards gained on play
* $x_{i1} =$ Yards to Endzone
* $x_{i2} =$ Yards to Go 
* $x_{i3} =$ Play Type (0=pass, 1= run)

The MLR model fit to this data is:

$$\hat y_i = 2.84 + 0.036x_{i1} + 0.14x_{i2} - 0.95x_{i3}$$

What is the meaning of the value -0.95?

\vspace{2in}






```{r eval=FALSE, include=FALSE, eval=F}
summary(lm(yards_gained ~ yardline_100 + play_type, data=nfl_den))
summary(lm(yards_gained ~ yardline_100 + ydstogo+ play_type, data=nfl_den))
summary(lm(yards_gained ~ yardline_100 + ydstogo, data=nfl_den))


summary(lm(Yards ~ YardsToEndzone + ToGo, data=nfl_den))
summary(lm(Yards ~ YardsToEndzone + ToGo + PlayType, data=nfl_den))
summary(lm(Yards ~ YardsToEndzone + score_differential + PlayType, data=nfl_den))



ggplot(nfl_den) + theme_bw() + 
   geom_point(aes(x=ydstogo, y=yards_gained, col=play_type))
```


## Recap of MLR parameter interpretation


### Interpreting the MLR model

Multiple linear regression model:
$$Y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \dots + \beta_kx_{ik} + \epsilon_i$$

Assumptions:

* $E[\epsilon_i] = 0$
* $Var(\epsilon_i) = \sigma^2$
* $\epsilon_i$ are uncorrelated

Interpretation overview:

* $\beta_0 =$ Average value of $Y_i$ when **all the $x$'s are zero**
* $\beta_j =$ Average difference in $Y_i$ for a 1-unit difference in $x_{ij}$ **among observations with the same value of all other $x$'s**
* $\sigma^2 =$ Variance of error term (variation in an observation $Y$ around its mean)



### Different Forms of Predictor Variables in MLR

Multiple linear regression can use different types of variables:

* Continuous variables (e.g. latitude)
* Binary variables (e.g.  border ocean or not)
* Categorical indicator variables (e.g. Freshman/Sophomore/Junior/Senior). *(Chapter 8)*
* Polynomial variables (e.g. engine size, engine size$^2$, engine size$^3$) *(Chapter 7)*
* Interactions between predictor variables. *(Chapter 8)*

The meaning of "all other $x$'s held constant" or "all other x's equal to zero" changes depending on the type of variable